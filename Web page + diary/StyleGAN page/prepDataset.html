<!DOCTYPE HTML>
<html>

<head>
  <title>StyleGan2-ada - Preparing the dataset</title>
  <meta name="description" content="website description" />
  <meta name="keywords" content="website keywords, website keywords" />
  <meta http-equiv="content-type" content="text/html; charset=windows-1252" />
  <link rel="stylesheet" type="text/css" href="style/style.css" />
</head>

<body>
  <div id="main">
    <div id="header">
      <div id="logo">
        <div id="logo_text">
          <!-- class="logo_colour", allows you to change the colour of the text -->
          <h1><a href="Home.html">Working with StyleGan2-ada<span class="logo_colour">[wip]</span></a></h1>
          <h2>How to set up and train a StyleGan2-ada network on a custom dataset</h2>
        </div>
      </div>
      <div id="menubar">
        <ul id="menu">
          <!-- put class="selected" in the li tag for the selected page - to highlight which page you're on -->
          <li ><a href="Home.html">Home</a></li>
          <li><a href="findDataset.html">Find Dataset</a></li>
          <li class="selected"><a href="prepDataset.html">Prepare Dataset</a></li>
          <li><a href="tfrecords.html">Convert to .tfrecords</a></li>
          <li><a href="train.html">Train Network</a></li>
          <li><a href="useTrained.html">Use Network</a></li>
        </ul>
      </div>
    </div>
    <div id="content_header"></div>
    <div id="site_content">
      <div id="banner"></div>
	  <div id="sidebar_container">

        <div class="sidebar">
          <div class="sidebar_top"></div>
          <div class="sidebar_item">
            <h3>Useful Links</h3>
            <ul>
              <li><a href="https://pastebin.com/BfqYAQJf">Image resizer.py on pastebin</a></li>
              <li><a href="https://androidkt.com/convert-tfrecords/">Article on labels</a></li>
              <li><a href="https://en.wikipedia.org/wiki/Training,_validation,_and_test_sets#Training_dataset">Training vs Validation sets</a></li>
              <li><a href="https://towardsdatascience.com/train-validation-and-test-sets-72cb40cba9e7">Info on splitting sets</a></li>
            </ul>
          </div>
          <div class="sidebar_base"></div>
        </div>
      </div>
      <div id="content">
        <!-- insert the page content here -->
        <h1>Preparing your dataset for conversion to a .tfrecords file</h1>
        <h2>Making the image the correct resolution</h2>
        <ul>
          <li>As mentioned before resolution of the images has to be a power of two, with identical height and width for example: 64x64,128x128,256x256.</li>
          <li>If your images are already in that format then you can skip this section of the guide</li>
          <li>However in my cats and dogs example all of the images are not square</li>
          <li>We must identify what power of 2 the images resoltions are all lower than, in my case all of the images are less than 512x512 in size so this will be my target resolution </li>
          <li>We will be using python along with the PIL module to resize and pad them. Python can be found <a href="https://www.python.org/downloads/">here</a> and a guide for installing PIL can be found <a href="https://blog.finxter.com/python-install-pil/">Here</a></li>
          <li>The code that i will provide will use PIL to convert your images like so:</li>
        </ul>
        <img src="style/dog comparison.png" alt="Before" height="200" width="600" />
		<p></p>
        <p>Code can be found below</p>
        <pre>
          <code>
<!-- Preformatted therefore it doesn't sit in indentation -->
from PIL import Image
import time
import os, sys

path = "PATH_HERE" #Input the path here of your folder of images, if there are any other files in the folder the program could stop working
dirs = os.listdir( path )
count = 0
desired_size = 512 #Please edit this to be your desired resolution
def resize():
    for item in dirs:
        filename=path+item
        if os.path.isfile(path+item):
            #Check if it is already resized before doing anything
            if (item[len(item)-5]!='r'):
                im = Image.open(filename)
                #Get size of image
                old_size = im.size

                ratio = float(desired_size)/max(old_size)
                new_size = tuple([int(x*ratio) for x in old_size])
                #this part ensures the image is rgb as an error would be thrown if it isnt
                if im.mode != 'RGB':
                    im = im.convert('RGB')
                f, e = os.path.splitext(filename)
                #Resizing
                im = im.resize(new_size, Image.ANTIALIAS)
                #Making a blank white image
                new_im = Image.new("RGB", (desired_size, desired_size))
                #Putting the original image on the desired size white image
                new_im.paste(im, ((desired_size-new_size[0])//2,
                    (desired_size-new_size[1])//2))
                print(item)
                #Save resized file
                new_im.save(f +'r.jpg', 'jpeg', quality=90)
                #             ^^^^this bit is the file name, im just doing the original name with r after it for resized
                #Delete original once done
                remove_file(filename)
#This function reattempts the delete until the file is available for deleting, stops a random error
def remove_file(path, retries=3, sleep=0.1):
    for i in range(retries):
        try:
            os.remove(path)
        except WindowsError:
            time.sleep(sleep)
        else:
            break

resize()

          </code>
        </pre>
		 <a href="https://pastebin.com/BfqYAQJf">Here is a link to the code on pastebin</a>
		 <p> </p>
		 <p>Note that some of the comments get cut off but they are copyable and will show up once pasted into python</p>
        <p>Simply copy and paste this code into the ide, choose your parameters and run the program. It will take some time to convert all of the images.</p>
        <h2>Preparing the labels of your dataset</h2>
        <p>While there are multiple methods for labelling your images, for the purposes of this tutorial i'm going to focus on the use of subfolders as labels. </p>
        <p>For example i have my dataset split into catsvsdogs/cats which has 12.5k images of cats and then catsvsddogs/dogs which contains 12.5k images of dogs.
        For more information on this please check out the link <a href="https://androidkt.com/convert-tfrecords/">here.</a></p>
        <h1>Training sets vs Validation sets</h1>
        <a href="https://en.wikipedia.org/wiki/Training,_validation,_and_test_sets#Training_dataset">Link to wiki page explaining the differences</a>
        <h2>Training Sets</h2>
        <ul>
          <li>A training dataset is a dataset of examples used during the learning process </li>
          <li>Unfortunately when we train the network on this data it tends to overfit the data in which it identifies and exploits apparent relationships in the training data that do not hold in general </li>
          <li>For example in my the dogs and cats dataset, the dog images could in general have more black padding due to them generally being lower resolution. However this correlation is just a coincidence and would not actually help to identify a dog </li>
          <li>So we've identified the problem, how do we fix it? </li>
        </ul>
        <h2>Validation Sets</h2>
        <ul>
          <li>We use a validation set to tune the hyperparameters (a parameter whose value is used to control the learning process) </li>
          <li>By doing this we can avoid overfitting and therefore make the network more accurate</li>
          <li>So how do we implement this practically?</li>
        </ul>
        <h2>Splitting the data</h2>
        <ul>
          <li>For now what we need to do is split our dataset into a training and a validation set</li>
          <li>Information on how the split should be proportioned can be found <a href="https://towardsdatascience.com/train-validation-and-test-sets-72cb40cba9e7">here</a></li>
          <li>I personally have 12.5k dogs and 12.5k cats. So in my scenario i am going to take 500 images from each for the validation set</li>
        </ul>
        <p>Your current file structure should look something like this:</p>
        <img src="style/Myfilestructure.png" alt="File Structure" height="200" width="600" />
        <p>Proceed to the next page on how to convert to .tfrecords by clicking <a href="tfrecords.html">here</a></p>
      </div>
    </div>
    <div id="content_footer"></div>
    <div id="footer">
      <p>Copyright &copy; simplestyle_horizon | <a href="http://validator.w3.org/check?uri=referer">HTML5</a> | <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> | <a href="http://www.html5webtemplates.co.uk">Simple web templates by HTML5</a></p>
    </div>
  </div>
</body>
</html>
